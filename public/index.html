<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <title>Document</title>
</head>

<body>
    <h1>proxy</h1>
    <div style="display: flex; gap: 1rem;">
        <label for="proxy_url">Proxy url</label>
        <input type="text" id="proxy_url" placeholder="proxy url" style="flex-grow: 1;">
    </div>
    <hr>
    <h2>Test</h2>
    <img id="image_test" src="https://hips.hearstapps.com/autoweek/assets/s3fs-public/140319900.jpg"
        style="width: 10rem; height: 10rem; object-fit: contain; border: solid;">
    <a id="image_anchor" target="_blank" href="https://hips.hearstapps.com/autoweek/assets/s3fs-public/140319900.jpg">
        Test Image</a>
    <br>
    <a id="pdf_anchor" href="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf">
        Test Pdf</a>
    <hr>
    <h2>HLS Streaming Example</h2>
    <div style="display: flex; gap: 1rem;">
        <label for="m3u8_url">HLS video url</label>
        <input type="text" id="hls_url" placeholder="HLS url" style="flex-grow: 1;">
    </div>
    <div style="display: flex; gap: 1rem; justify-content: center; align-items: center;">
        <button id="load_video">Load video</button>
    </div>

    <video id="video" controls style="width: 100%;"></video>

    <script>
        const currentDomain = window.location.origin;
        $('#proxy_url').val(`${currentDomain}/api/proxy?url=`);

        const exampleHlsVideo = "https://ea.netmagcdn.com:2228/hls-playback/fab0f470f2d1523ce69135147764c7ed448a5370e578ecf9195da9e269e7d6c19acbe06eedbdd88c67499b4ee507339e59d35511a097b6bc0f912210c98b71170a2386b69738b296924f6631c044c0f38065e145c5b441285716ab56935c24e5bab308466ab8bce1a5f8d36218f0ee028b63116deb8b3b974c4a5c058663bfeee73c9a6188c898d5a91220361b00da59/master.m3u8";
        $('#hls_url').val(exampleHlsVideo);

        function updateProxyUrl() {
            const proxyUrl = $('#proxy_url').val();

            $('#image_test').attr('src', proxyUrl + $('#image_test').attr('src'));
            $('#image_anchor').attr('href', proxyUrl + $('#image_anchor').attr('href'));
            $('#pdf_anchor').attr('href', proxyUrl + $('#pdf_anchor').attr('href'));
        }
        $('#proxy_url').on('change', updateProxyUrl);
        updateProxyUrl();




        function loadVideo() {
            console.log('loadVideo');
            const video = $('#video')[0];
            const proxiedUrl = $('#proxy_url').val() + encodeURIComponent($('#hls_url').val());

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(proxiedUrl);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    // video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Fallback for browsers that natively support HLS (like Safari)
                video.src = proxiedUrl;
                video.addEventListener('loadedmetadata', function () {
                    // video.play();
                });
            }
        }

        $('#load_video').on('click', loadVideo);
    </script>
</body>

</html>